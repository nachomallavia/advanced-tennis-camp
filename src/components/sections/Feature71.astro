---
import ArrowRight from '@lucide/astro/icons/arrow-right';
import { cn } from "@/lib/utils";
import { getImage } from "astro:assets";
import type { ImageMetadata } from "astro";
import { DirectionAwareHover } from "@/components/ui/DirectionAwareHover";
import MetricCard from '@/components/ui/MetricCard.astro';

interface Props {
  class?: string;
  metrics?: Array<{
    value: string;
    label: string;
    imageUrl?: string;
  }>;
  featuredCards?: Array<{
    href: string;
    backgroundImage: ImageMetadata | string;
    logo: string;
    logoAlt: string;
    linkText: string;
  }>;
}

const {
  class: className,
  metrics = [
    { value: "100+", label: "Metric 1" },
    { value: "5", label: "Metric 2" },
    { value: "150+", label: "Metric 3" },
    { value: "10", label: "Metric 4" },
  ],
  featuredCards = [
    {
      href: "#",
      backgroundImage: "https://images.unsplash.com/photo-1548324215-9133768e4094?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w2NDI3NzN8MHwxfGFsbHwxMzF8fHx8fHwyfHwxNzIzNDM1MzA1fA&ixlib=rb-4.0.3&q=80&w=1080",
      logo: "https://deifkwefumgah.cloudfront.net/shadcnblocks/block/logos/astro-wordmark.svg",
      logoAlt: "Astro logo",
      linkText: "Read more",
    },
    {
      href: "#",
      backgroundImage: "https://images.unsplash.com/photo-1550070881-a5d71eda5800?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w2NDI3NzN8MHwxfGFsbHwxMjV8fHx8fHwyfHwxNzIzNDM1Mjk4fA&ixlib=rb-4.0.3&q=80&w=1080",
      logo: "https://deifkwefumgah.cloudfront.net/shadcnblocks/block/logos/shadcn-ui-wordmark.svg",
      logoAlt: "shadcn/ui logo",
      linkText: "Read more",
    },
  ],
} = Astro.props;

// Process images for featured cards
const processedCards = await Promise.all((featuredCards || []).map(async (card) => {
  const imageUrl = typeof card.backgroundImage === 'string' 
    ? card.backgroundImage 
    : (await getImage({ src: card.backgroundImage })).src;
  return { ...card, imageUrl };
}));
---

<section class={cn("", className)}>
  <div class="container mx-auto px-4 flex flex-col items-center gap-12">
    <!-- Grid Section -->
    <div class="grid w-full grid-cols-2 gap-4 sm:gap-6 lg:grid-cols-4 lg:gap-4">
      <!-- First Featured Card -->
      {processedCards[0] && (
        <div class="col-span-2 sm:max-lg:col-span-2 overflow-clip rounded-none">
          <DirectionAwareHover 
            client:load
            imageUrl={processedCards[0].imageUrl}
            href={processedCards[0].href}
            className="sm:aspect-3/2"
          >
            <div class="relative flex h-full w-full flex-col items-start justify-end p-4 md:p-6 lg:p-10">
              {/* <img
                src={processedCards[0].logo}
                alt={processedCards[0].logoAlt}
                class="mb-12 h-8 invert md:h-12 dark:invert"
              /> */}
              <div class="flex items-center text-xs font-medium text-white md:text-base lg:text-lg">
                {processedCards[0].linkText}
                <ArrowRight class="ml-2 size-4 transition-transform group-hover:translate-x-1" />
              </div>
            </div>
          </DirectionAwareHover>
        </div>
      )}

      <!-- Metrics Grid -->
      {metrics.slice(0, 2).map((metric) => (

          <MetricCard className="rounded-none" title={metric.label} value={metric.value} imageUrl={metric.imageUrl} />
      ))}

      {metrics.slice(2, 4).map((metric) => (
        <MetricCard className="rounded-none" title={metric.label} value={metric.value} imageUrl={metric.imageUrl} />
      ))}

      <!-- Second Featured Card -->
      {processedCards[1] && (
        <div class="col-span-2 sm:max-lg:col-span-1 overflow-clip rounded-none">
          <DirectionAwareHover 
            client:load
            imageUrl={processedCards[1].imageUrl}
            href={processedCards[1].href}
            className="sm:aspect-2/1"
          >
            <div class="relative flex h-full w-full flex-col items-start justify-end gap-4 p-4 md:flex-row md:items-end md:p-6 lg:p-10">
              {/* <div>
                <img
                  src={processedCards[1].logo}
                  alt={processedCards[1].logoAlt}
                  class="mb-8 h-7 invert md:mb-0 dark:invert"
                />
              </div> */}
              <div class="flex shrink-0 items-center text-xs font-medium text-white md:text-base lg:text-lg">
                {processedCards[1].linkText}
                <ArrowRight class="ml-2 size-4 transition-transform group-hover:translate-x-1" />
              </div>
            </div>
          </DirectionAwareHover>
        </div>
      )}
    </div>
  </div>
</section>

